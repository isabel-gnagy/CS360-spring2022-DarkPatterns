<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>Cob's</title>
	<link href="style.css" rel="stylesheet" type="text/css" />
  <script src="script.js"></script>
 
</head>
<style>
  
  #tools{
    width: 100%;
    display: flex;
    justify-content: space-around;
  }
  
  
  .game{
    display: flex;
    justify-content: center;
    padding: 2em;
  }
  canvas { 
    border:5px solid black;
    background-color: white;
  }
  #show{
    background-color: white;
  }
  .progress{
    display: flex;
    justify-content: center;
  }
  progress{
    -webkit-appearance: none;
    appearance: none;
    width: 250px;
    height: 20px;
}
</style> 
<script type="text/javascript">
  function play_game()
  {
  var level = 160; // Game level, by decreasing will speed up
  var rect_w = 45; // Width
  var rect_h = 30; // Height
  var inc_score = 50; // Score
  var snake_color = "#0520A5"; // Snake Color
  var ctx; // Canvas attributes
  var tn = []; // temp directions storage
  var x_dir = [-1, 0, 1, 0]; // position adjusments
  var y_dir = [0, -1, 0, 1]; // position adjusments
  var queue = [];
  var frog = 1; // defalut food
  var map = [];
  var MR = Math.random;
  var X = 5 + (MR() * (rect_w - 10))|0; // Calculate positions
  var Y = 5 + (MR() * (rect_h - 10))|0; // Calculate positions
  var direction = MR() * 3 | 0;
  var interval = 0;
  var score = 0;
  var sum = 0, easy = 0;
  var i, dir;
  // getting play area 
  var c = document.getElementById('playArea');
  ctx = c.getContext('2d');
  // Map positions
  for (i = 0; i < rect_w; i++){
  map[i] = [];
  }
  // random placement of snake food
  function random_snake(){
  var x, y;
  do{
  x = MR() * rect_w|0;
  y = MR() * rect_h|0;
  }
  while (map[x][y]);
  map[x][y] = 1;
  ctx.fillStyle = snake_color;
  ctx.strokeRect(x * 10+1, y * 10+1, 8, 8);
  }
  // Default somewhere placement
  random_snake();
  function set_game_speed(){
  if (easy){
  X = (X+rect_w)%rect_w;
  Y = (Y+rect_h)%rect_h;
  }
  --inc_score;
  if (tn.length)
  {
  dir = tn.pop();
  if ((dir % 2) !== (direction % 2)){
  direction = dir;
  }
  }
  if ((easy || (0 <= X && 0 <= Y && X < rect_w && Y < rect_h)) && 2 !== map[X][Y]){
  if (1 === map[X][Y]){
  score+= Math.max(5, inc_score);
  inc_score = 50;
  random_snake();
  frog++;
  }
  //ctx.fillStyle("#ffffff");
  ctx.fillRect(X * 10, Y * 10, 9, 9);
  map[X][Y] = 2;
  queue.unshift([X, Y]);
  X+= x_dir[direction];
  Y+= y_dir[direction];
  if (frog < queue.length)
  {
  dir = queue.pop()
  map[dir[0]][dir[1]] = 0;
  ctx.clearRect(dir[0] * 10, dir[1] * 10, 10, 10);
  }
  }
  else if (!tn.length)
  {
  var show_score = document.getElementById("show");
  show_score.innerHTML = "You lose!<br /> <u>Your Cob Bucks:</u> <b>"+score+"</b><br><br> Want to try again?<br><br><input type='button' value='Play Again' onclick='window.location.reload();' />";
  document.getElementById("playArea").style.display = 'none';
  window.clearInterval(interval);
  }
  }
  interval = window.setInterval(set_game_speed, level);
  document.onkeydown = function(e) {
  var code = e.keyCode - 37;
  if (0 <= code && code < 4 && code !== tn[0])
  {
  tn.unshift(code);
  }
  else if (-5 == code)
  {
  if (interval)
  {
  window.clearInterval(interval);
  interval = 0;
  }
  else
  {
  interval = window.setInterval(set_game_speed, 60);
  }
  }
  else
  {
  dir = sum + code;
  if (dir == 44||dir==94||dir==126||dir==171) {
  sum+= code
  } else if (dir === 218) easy = 1;
  }
  }
  }
</script>
<body onload="play_game()">
    <a href="dark_login.html"><img src="images/home.png" alt="home" style="height:20px; width:auto;"></a>
    <h1 id="header">Cob's Soulo Game</h1> <br>
  </div>
  <div id="tools">
    <a href="dark_bonus.html" style="width: 100%;"><button style="width: 100%; font-size: 2em;">Bonus</button></a>
    <a href="dark_shop.html"style="width: 100%;"><button style="width: 100%; font-size: 2em;">Store</button></a>
    <a href="dark_checkout.html"style="width: 100%;"><button style="width: 100%; font-size: 2em;">Recharge</button></a>
  </div>
  <div class="game">
    <div id="show"></div>
    <canvas id="playArea" width="400" height="300"></canvas>
  </div>
  <div class="progress">
    <table style="width: 30%;">
      <tr>
        <td>Login bonus:</td>
        <td>Login at midnight to get dark mode!</td>
      </tr>
      <tr style="display: block;" id="locked">
        <td><progress id="days" value="6" max="7"></progress></td>
        <td><img id="image" src="images/bar_locked.png" style="height: 40px; width: auto;"></td>
      </tr>
    </table>
  </div>
</div>

</body>
</html>
